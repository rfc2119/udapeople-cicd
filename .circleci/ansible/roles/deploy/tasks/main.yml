---

- name: print cwd
  debug:
    msg:
      - " cwd: {{ lookup('env', 'PWD') }} "

# TODO
# - name: record whoami
#   command: whoami
#   register: os_user


- name: Copy backend built files to backend server
  synchronize:
    # TODO: hard-coded values
    src: '/home/circleci/project/backend/dist'  # TODO: because ansible was run inside the project dir
    dest: udapeople-cicd/backend/
    recursive: yes
    archive: yes

- name: start production server
  shell:
    chdir: udapeople-cicd/backend
    cmd: pm2 start --name "api-backend" npm -- run start:prod
    # TODO: systemd and start as a service

    # TODO: wgat us tge dufferebce ?
- name: start dist/main.js
  chdir: udapeople-cicd/backend/dist
  shell: pm2 start main.js
